## CORS - Cross Origin Resource Sharing
 - 다른 출처간에 리소스를 공유할 수 있도록 하는 것을 말한다.
 - 한 사이트에서 주소가 다른 서버로 요청을 보낼 때 프론트엔드에서 HTTP 요청을 보냈을 때 미리 어떤 설정을 해 주지 않으면 CORS 문제로 막히게 된다.
 - 스프링 같은 백엔드에서 HTTP로 요청을 보내면 가능하지만 웹사이트에서 보내면 CORS 같은 오류를 볼 수 있다.
 - 원래 다른 출처끼리 요청을 주고 받는건 안되는게 기본값이지만 웹 생태계가 다양해지면서 여러 서비스들간에 보다 자유롭게 데이터가 주고받아질 필요가 생겼다. 그런데 다른 사이트간의 요청들을 브라우저가 막고 있으니깐 과거 개발자들은 JSONP등의 방식으로 이를 우회하는 꼼수를 썼었다. 그래서 이걸 합의된 출처들간에 합법적으로 허용해주기 위해 어떤 기준을 충족시키면 리소스 공유가 되도록 만들어진 매커님즘이 바로 이 CORS, 교차 출처 자원 공유 방식이다. 
 - 요청을 받는 백엔드쪽에서 이걸 허락할 다른 출처들을 미리 명시해두어야 한다.
 - 스프링, 장고, Express 등의 문서를 살펴보면 CORS 옵션을 넣는 방법들이 나와있다.
 - 브라우저는 다른 출처끼리의 요청이 보내질 때는 요청에 Origin이라는 header를 추가한다.
 - 이 header의 Origin 항목에는 요청하는쪽의 scheme과 도메인, 그리고 포트가 담겨있다. 예를들면 https://배기훈.com 으로 치면 https가 scheme, 배기훈.com이 도메인 그리고 안 붙었지만 만약 뒤에 :8080 등이 달려있으면 그것이 포트이다.
 - 요청을 받은 API 서버는 답장의 헤더에 지정된 Access-Control-Allow-Origin 정보를 실어서 보낸다. 만약 배기훈.com이 등록된 상태면 그 URL도 들어있다.
 - 그럼 크롬과 같은 브라우저가 Origin에서 보낸 출처값이 서버의 답장 헤더에 담긴 Access-Control-Allow-Origin에 똑같이 있으면 안전한 요청으로 간주하고, 응답 데이터를 받아오게 된다. 그것이 없으면 에러 메세지를 띄워주게된다.
 - 토큰 등 사용자 식별 정보가 담긴 요청에 대해서는 더 엄격하다. 보내는 측에서는 요청의 옵션에 credentials 항목을 true로 세팅해야하고 받는쪽에서도 아무 출처나 다 된다는 와일드카드가 아니라 보내는 쪽의 출처 - 웹페이지 주소를 정확히 명시한 다음 Access-Control-Allow-Credentials 항목을 true로 맞춰주어야한다.
  - 위에서 이야기한 방식은 Simple request라고 해서 GET이나 POST 등 일정 조건의 요청들에 사용되는 것이고 PUT이나 DELETE등 이와 다른 요청들은 본 요청을 보내기 전에 Preflight 요청이란 걸 먼저 보내서 본 요청이 안전한지 확인하고 여기서 허락이 떨어져야 본격적으로 요청을 보낼 수 있다. 서버의 데이터에 영향을 줄 수 있는 요청들이기 때문에 요청 자체를 보내기 전에 먼저 허용 여부를 검증하는 것이다.
 - 정리하면 CORS에서 요청들은 두종류인 Simple request, Preflight request로 나뉘는데 Simple request는 요청을 보내기는 다 보내는데 통과를 못하면 답장만 못 받아오는거고 Preflight request는 요청을 '보내는 것' 도 허락을 먼저 받아야 하고 허락이 떨어지면 요청을 보낼 수 있다. 
 - Simple request로 보내는 것들로도 받는쪽에서 신경 안 써놓으면 서버에 저장된 데이터에 변경이 가해질 수 있는데 이 때문에 SOP만 믿을 게 아니라, 개발자 측에서도 그런 것들에 다 대비해서 서버를 프로그래밍해야한다.







